<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>HL7 Validator</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
<style>
    .hidden {
        display: none;
      }
      
      #popup {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        padding: 20px;
        background-color: #f9f9f9;
        border: 1px solid #ccc;
        z-index: 1000;
      }
</style>

</head>

<body>
<div class="container-fluid px-5">
    <div class="row align-items-center">
        <div class="col-3">
            <img style="float:left; width:80%;" src="/static/pdh.jpeg" class="rounded float-left" alt="GH">
        </div>
        <div class="col-9">
            <h1>Pergunte coisas aos medicamentos portugeses.</h1>
            <p>Criámos uma inteligência artificilar que responde em função dos RCMs dos medicamentos disponiveis em Portugal</p>
        </div>

    </div>

    <form method="POST" role="form">
        <div class="form-group">
            <label for="exampleFormControlTextarea1">
                <h3>Este formulário permite fazer perguntas aos RCMs</h3>
            </label>

            <div id="popup" class="hidden">
                <p>A procurar informação e a criar a resposta, aguarde...</p>
              </div>
            <textarea class="form-control" id="exampleFormControlTextarea1" name="msg" rows="3">{{ msg }}</textarea>
        </div>
        <button id="fetchButton" type="submit" class="btn btn-primary">Submeter</button>
        <button type="button" class="btn btn-secondary" onclick="clearContent()">Limpar</button>
       

    </form>
    <br>

    {% if answer %}
    <h2>Resposta:</h2>
    <div class="alert alert-primary" role="alert">
        {{ answer }}
        </div>
{% if details%}
<p>Documentos usados: </p>
<ul>
{% for detail in details %}
<li>{{detail}}</li>
{% endfor %}
</ul>
{% endif %}

    {% endif %}
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>

</body>
<footer>
</footer>
<script>
    function clearContent() {
        document.getElementById('exampleFormControlTextarea1').value = '';
    }
    </script>
    <script>
document.getElementById('fetchButton').addEventListener('click', function() {
  // Show the popup
  document.getElementById('popup').classList.remove('hidden');

  const formData = new FormData(event.target);

  // Perform a POST request
  fetch('/', {
    method: 'POST', // Specify the method
    body: formData, // FormData object as the body

    headers: {
      'Content-Type': 'application/json', // Specify the content type
    },  })
  .then(response => {
    if (!response.ok) {
      throw new Error('Network response was not ok');
    }
    return response.json(); // or .text(), .blob(), etc. depending on the response type
  })
  .then(data => {
    console.log(data); // Process your response data here
    // Hide the popup when done
    document.getElementById('popup').classList.add('hidden');
  })
  .catch(error => {
    console.error('Error:', error);
    // Hide the popup even if there's an error
    document.getElementById('popup').classList.add('hidden');
  });
});
    </script>
</html>